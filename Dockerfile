FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogJzEuMC4wJwpuYW1lOiBjbG91ZC1uYXRpdmUtd29ya3Nob3AtYXBiCmRlc2NyaXB0\
aW9uOiBBUEIgdG8gZGVwbG95IHJlcXVpcmVkIGluZnJhIGNvbXBvbmVudHMgZm9yIENsb3VkLU5h\
dGl2ZSBXb3Jrc2hvcHMgb24gYW4gT3BlblNoaWZ0IGNsdXN0ZXIKYmluZGFibGU6IEZhbHNlCmFz\
eW5jOiBvcHRpb25hbAp0YWdzOgotIHdvcmtzaG9wCi0gY2xvdWQtbmF0aXZlCm1ldGFkYXRhOgog\
IGRlcGVuZGVuY2llczogW10KICBkaXNwbGF5TmFtZTogIkNsb3VkLU5hdGl2ZSBXb3Jrc2hvcCAo\
Q29kZVJlYWR5KSBJbnN0YWxsZXIiCiAgbG9uZ0Rlc2NyaXB0aW9uOiAiUmVxdWlyZWQgY29tcG9u\
ZW50cyAoQ29kZVJlYWR5IFdvcmtzcGFjZXMsIE5leHVzLCBHb2dzLCBXb3Jrc2hvcHBlcikiCiAg\
Y29uc29sZS5vcGVuc2hpZnQuaW8vaWNvbkNsYXNzOiAicGZpY29uIHBmaWNvbi1zZXJ2aWNlcyIK\
ICBwcm92aWRlckRpc3BsYXlOYW1lOiAiUmVkIEhhdCwgSW5jLiIKcGxhbnM6CiAgLSBuYW1lOiBk\
ZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogVGhpcyBkZWZhdWx0IHBsYW4gZGVwbG95cyBjbG91ZC1u\
YXRpdmUtd29ya3Nob3AKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1l\
dGVyczoKICAgIC0gbmFtZTogb3BlbnNoaWZ0X3VzZXIKICAgICAgdGl0bGU6IFVzZXJuYW1lCiAg\
ICAgIGRlc2NyaXB0aW9uOiBVc2VyIGlzIHJlcXVpcmVkIGZvciBjcmVhdGluZyBwcm9qZWN0IGFk\
bWluIHJlc291cmNlcwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\
ICAgZGlzcGxheV9ncm91cDogT3BlblNoaWZ0IE1hc3RlcgogICAgLSBuYW1lOiBvcGVuc2hpZnRf\
cGFzc3dvcmQKICAgICAgdGl0bGU6IFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBQYXNzd29y\
ZCBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVjdCBhZG1pbiByZXNvdXJjZXMKICAgICAg\
dHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlwZTogcGFz\
c3dvcmQKICAgICAgZGlzcGxheV9ncm91cDogT3BlblNoaWZ0IE1hc3RlcgogICAgLSBuYW1lOiBv\
cGVuc2hpZnRfbWFzdGVyX3VybAogICAgICB0aXRsZTogT3BlblNoaWZ0IE1hc3RlciBVUkwKICAg\
ICAgZGVzY3JpcHRpb246IFRoZSBhZGRyZXNzIHRvIE9wZW5TaGlmdCBtYXN0ZXIgVVJMIHRvIGJl\
IGRpc3BsYXllZCBpbiB0aGUgbGFiIGd1aWRlIHRvIHBhcnRpY2lwYW50cwogICAgICB0eXBlOiBz\
dHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBzdHJpbmcKICAg\
ICAgZGlzcGxheV9ncm91cDogT3BlblNoaWZ0IE1hc3RlcgogICAgLSBuYW1lOiBvcGVuc2hpZnRf\
dXNlcl9wYXNzd29yZAogICAgICB0aXRsZTogT3BlblNoaWZ0IFVzZXIgUGFzc3dvcmQKICAgICAg\
ZGVzY3JpcHRpb246IFRoZSBPcGVuU2hpZnQgcGFzc3dvcmQgZm9yIHBhcnRpY2lwYW50cyB0byBi\
ZSBkaXNwbGF5ZWQgaW4gdGhlIGxhYiBndWlkZSB0byBwYXJ0aWNpcGFudHMKICAgICAgdHlwZTog\
c3RyaW5nCiAgICAgIGRlZmF1bHQ6ICJvcGVuc2hpZnQiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgIGRpc3BsYXlfdHlwZTogc3RyaW5nCiAgICAgIGRpc3BsYXlfZ3JvdXA6IExhYnMgJiBHdWlk\
ZXMKICAgIC0gbmFtZTogZ2l0X3JlcG9zaXRvcnlfZ3VpZGVfcGF0aAogICAgICB0aXRsZTogR2l0\
IFJlcG9zaXRvcnkgR3VpZGUgUGF0aAogICAgICBkZXNjcmlwdGlvbjogVGhlIFBhdGggb2YgdGhl\
IHJlcG9zaXRvcnkgd2l0aCB0aGUgbGFiIGd1aWRlIGZvciBwYXJ0aWNpcGFudHMgPGdpdGh1Yl9h\
Y2NvdW50Pi88Z2l0aHViX3Byb2plY3Q+CiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0\
OiAibWNvdWxpYmEvY2xvdWQtbmF0aXZlLWd1aWRlcyIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\
ICAgZGlzcGxheV90eXBlOiBzdHJpbmcKICAgICAgZGlzcGxheV9ncm91cDogTGFicyAmIEd1aWRl\
cwogICAgLSBuYW1lOiBnaXRfcmVwb3NpdG9yeV9ndWlkZV9yZWZlcmVuY2UKICAgICAgdGl0bGU6\
IEdpdCBSZXBvc2l0b3J5IEd1aWRlIFJlZmVyZW5jZQogICAgICBkZXNjcmlwdGlvbjogU2V0IHRo\
aXMgdG8gYSBicmFuY2ggbmFtZSwgdGFnIG9yIG90aGVyIHJlZiBvZiB5b3VyIHJlcG9zaXRvcnkg\
aWYgeW91IGFyZSBub3QgdXNpbmcgdGhlIGRlZmF1bHQgYnJhbmNoLgogICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgZGVmYXVsdDogIm9jcC0zLjExIgogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBk\
aXNwbGF5X3R5cGU6IHN0cmluZwogICAgICBkaXNwbGF5X2dyb3VwOiBMYWJzICYgR3VpZGVzCiAg\
ICAtIG5hbWU6IGdpdF9yZXBvc2l0b3J5X2xhYl9wYXRoCiAgICAgIHRpdGxlOiBHaXQgUmVwb3Np\
dG9yeSBMYWIgUGF0aAogICAgICBkZXNjcmlwdGlvbjogVGhlIFBhdGggb2YgdGhlIHJlcG9zaXRv\
cnkgd2l0aCB0aGUgbGFiIGZvciBwYXJ0aWNpcGFudHMgPGdpdGh1Yl9hY2NvdW50Pi88Z2l0aHVi\
X3Byb2plY3Q+CiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAibWNvdWxpYmEvY2xv\
dWQtbmF0aXZlLWxhYnMiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlwZTog\
c3RyaW5nCiAgICAgIGRpc3BsYXlfZ3JvdXA6IExhYnMgJiBHdWlkZXMKICAgIC0gbmFtZTogZ2l0\
X3JlcG9zaXRvcnlfbGFiX3JlZmVyZW5jZQogICAgICB0aXRsZTogR2l0IFJlcG9zaXRvcnkgTGFi\
IFJlZmVyZW5jZQogICAgICBkZXNjcmlwdGlvbjogU2V0IHRoaXMgdG8gYSBicmFuY2ggbmFtZSwg\
dGFnIG9yIG90aGVyIHJlZiBvZiB5b3VyIHJlcG9zaXRvcnkgaWYgeW91IGFyZSBub3QgdXNpbmcg\
dGhlIGRlZmF1bHQgYnJhbmNoLgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogIm9j\
cC0zLjExIgogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHN0cmluZwog\
ICAgICBkaXNwbGF5X2dyb3VwOiBMYWJzICYgR3VpZGVzCiAgICAtIG5hbWU6IGluZnJhc3Zjc19h\
ZG1fdXNlcgogICAgICB0aXRsZTogSW5mcmEgU2VydmljZXMgQWRtaW4gVXNlcgogICAgICBkZXNj\
cmlwdGlvbjogQWRtaW4gdXNlciBmb3IgaW5mcmFzdHJ1Y3R1cmUgc2VydmljZXMgKEdvZ3MsIE5l\
eHVzLCAuLi4pCiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAiYWRtaW51c2VyIgog\
ICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxh\
eV9ncm91cDogV29ya3Nob3AgSW5mcmEgU2VydmljZXMKICAgIC0gbmFtZTogaW5mcmFzdmNzX2Fk\
bV9wd2QKICAgICAgdGl0bGU6IEluZnJhIFNlcnZpY2VzIEFkbWluIFBhc3N3b3JkCiAgICAgIGRl\
c2NyaXB0aW9uOiBBZG1pbiBwYXNzd29yZCBmb3IgaW5mcmFzdHJ1Y3R1cmUgc2VydmljZXMgKEdv\
Z3MsIE5leHVzLCAuLi4pCiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAiYWRtaW5w\
d2QiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBk\
aXNwbGF5X2dyb3VwOiBXb3Jrc2hvcCBJbmZyYSBTZXJ2aWNlcwogICAgLSBuYW1lOiBpbml0aWFs\
aXplX3Byb2plY3RfcGVybWlzc2lvbnMKICAgICAgdGl0bGU6IEluaXRpYWxpemUgcHJvamVjdCB3\
aXRoIHBlcm1pc3Npb25zCiAgICAgIGRlc2NyaXB0aW9uOiBTZXQgdGhpcyB0byBpbml0aWFsaXpl\
IHByb2plY3Qgd2l0aCBwZXJtaXNzaW9ucyBmcm9tIHVzZXIxIHRvIHVzZXIgMTAwCiAgICAgIHR5\
cGU6IGJvb2xlYW4KICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\
ICAgZGlzcGxheV90eXBlOiBjaGVja2JveAogICAgICBkaXNwbGF5X2dyb3VwOiBPcGVuc2hpZnQg\
V29ya3Nob3Agb24gUkhQRFMgb25seSAodXNlcjEtMTAwKQogICAgLSBuYW1lOiBsb2NhbF9raWFs\
aV9pbnN0YWxsYXRpb24KICAgICAgdGl0bGU6IExvY2FsIEtpYWxpIEluc3RhbGxhdGlvbgogICAg\
ICBkZXNjcmlwdGlvbjogU2V0IHRoaXMgdG8gaW5zdGFsbCBLaWFsaSBmcm9tIHVzZXIxIHRvIHVz\
ZXIgMTAwIChTZXJ2aWNlIE1lc2ggd2l0aCBLaWFsaSBSZXF1aXJlZCkKICAgICAgdHlwZTogYm9v\
bGVhbgogICAgICBkZWZhdWx0OiBmYWxzZQogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNw\
bGF5X3R5cGU6IGNoZWNrYm94CiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5zaGlmdCBXb3Jrc2hv\
cCBvbiBSSFBEUyBvbmx5ICh1c2VyMS0xMDAp"

COPY playbooks /opt/apb/project
COPY templates /opt/apb/project/templates
COPY tasks /opt/apb/project/tasks
ADD requirements.yml /opt/apb/project/requirements.yml
RUN ansible-galaxy install -r /opt/apb/project/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
