FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogJzEuMC4wJwpuYW1lOiBjbG91ZC1uYXRpdmUtZGV2ZWxvcG1lbnQKZGVzY3JpcHRp\
b246IEFQQiB0byBkZXBsb3kgcmVxdWlyZWQgaW5mcmEgY29tcG9uZW50cyBmb3IgdGhlIENsb3Vk\
LU5hdGl2ZSBEZXZlbG9wbWVudCBvbiBhbiBPcGVuU2hpZnQgY2x1c3RlcgpiaW5kYWJsZTogRmFs\
c2UKYXN5bmM6IG9wdGlvbmFsCnRhZ3M6Ci0gd29ya3Nob3AKbWV0YWRhdGE6CiAgZGVwZW5kZW5j\
aWVzOiBbXQogIGRpc3BsYXlOYW1lOiAiQ2xvdWQtTmF0aXZlIERldmVsb3BtZW50IEluc3RhbGxl\
ciIKICBsb25nRGVzY3JpcHRpb246ICJSZXF1aXJlZCBjb21wb25lbnRzIChHaXQgc2VydmVyLCBO\
ZXh1cywgRWNsaXBzZSBDaGUsIGV0YykiCiAgY29uc29sZS5vcGVuc2hpZnQuaW8vaWNvbkNsYXNz\
OiAicGZpY29uIHBmaWNvbi1wcm9jZXNzLWF1dG9tYXRpb24iCiAgcHJvdmlkZXJEaXNwbGF5TmFt\
ZTogIlJlZCBIYXQsIEluYy4iCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRp\
b246IFRoaXMgZGVmYXVsdCBwbGFuIGRlcGxveXMgY2xvdWQtbmF0aXZlLWRldmVsb3BtZW50CiAg\
ICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToge30KICAgIHBhcmFtZXRlcnM6CiAgICAtIG5hbWU6\
IG9wZW5zaGlmdF91c2VyCiAgICAgIHRpdGxlOiBVc2VybmFtZQogICAgICBkZXNjcmlwdGlvbjog\
VXNlciBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVjdCBhZG1pbiByZXNvdXJjZXMKICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfZ3JvdXA6\
IE9wZW5TaGlmdCBBZG1pbiBVc2VyCiAgICAtIG5hbWU6IG9wZW5zaGlmdF9wYXNzd29yZAogICAg\
ICB0aXRsZTogUGFzc3dvcmQKICAgICAgZGVzY3JpcHRpb246IFBhc3N3b3JkIGlzIHJlcXVpcmVk\
IGZvciBjcmVhdGluZyBwcm9qZWN0IGFkbWluIHJlc291cmNlcwogICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICBk\
aXNwbGF5X2dyb3VwOiBPcGVuU2hpZnQgQWRtaW4gVXNlcgogICAgLSBuYW1lOiBvcGVuc2hpZnRf\
bWFzdGVyX3VybAogICAgICB0aXRsZTogT3BlblNoaWZ0IE1hc3RlciBVUkwKICAgICAgZGVzY3Jp\
cHRpb246IFRoZSBhZGRyZXNzIHRvIE9wZW5TaGlmdCBtYXN0ZXIgVVJMIHRvIGJlIGRpc3BsYXll\
ZCBpbiB0aGUgbGFiIGd1aWRlIHRvIHBhcnRpY2lwYW50cwogICAgICB0eXBlOiBzdHJpbmcKICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBzdHJpbmcKICAgICAgZGlzcGxh\
eV9ncm91cDogTGFiIEd1aWRlCiAgICAtIG5hbWU6IG9wZW5zaGlmdF91c2VyX3Bhc3N3b3JkCiAg\
ICAgIHRpdGxlOiBPcGVuU2hpZnQgVXNlciBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogVGhl\
IE9wZW5TaGlmdCBwYXNzd29yZCBmb3IgcGFydGljaXBhbnRzIHRvIGJlIGRpc3BsYXllZCBpbiB0\
aGUgbGFiIGd1aWRlIHRvIHBhcnRpY2lwYW50cwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVx\
dWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBzdHJpbmcKICAgICAgdmFsdWU6ICJvcGVu\
c2hpZnQiCiAgICAgIGRpc3BsYXlfZ3JvdXA6IExhYiBHdWlkZQogICAgLSBuYW1lOiBpbmZyYXN2\
Y3NfYWRtX3VzZXIKICAgICAgdGl0bGU6IEluZnJhIFNlcnZpY2VzIEFkbWluIFVzZXIKICAgICAg\
ZGVzY3JpcHRpb246IEFkbWluIHVzZXIgZm9yIGluZnJhc3RydWN0dXJlIHNlcnZpY2VzIChHb2dz\
LCBDaGUsIC4uLikKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6ICJhZG1pbnVzZXIi\
CiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBkaXNw\
bGF5X2dyb3VwOiBXb3Jrc2hvcCBJbmZyYSBTZXJ2aWNlcwogICAgLSBuYW1lOiBpbmZyYXN2Y3Nf\
YWRtX3B3ZAogICAgICB0aXRsZTogSW5mcmEgU2VydmljZXMgQWRtaW4gUGFzc3dvcmQKICAgICAg\
ZGVzY3JpcHRpb246IEFkbWluIHBhc3N3b3JkIGZvciBpbmZyYXN0cnVjdHVyZSBzZXJ2aWNlcyAo\
R29ncywgQ2hlLCAuLi4pCiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAiYWRtaW5w\
d2QiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBk\
aXNwbGF5X2dyb3VwOiBXb3Jrc2hvcCBJbmZyYSBTZXJ2aWNlcw=="

COPY playbooks /opt/apb/actions
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb